<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Giriş / Kayıt | TradeMirror Auth Portal</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&family=Orbitron:wght@500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <style>
        /* CSS Değişkenleri (index.html ile uyumlu) */
        :root {
            --bg-dark: #0a0a1a;
            --bg-card: #14142a;
            --color-primary: #00bcd4; /* Teal/Mavi */
            --color-secondary: #8e8dff; /* Mor/Mavi ton */
            --color-text: #e9e9f1;
            --color-danger: #ff6b6b;
            --color-success: #38c172;
            --border-radius: 12px;
            --box-shadow: 0 10px 30px rgba(0, 0, 0, 0.7);
            --input-bg: #1a1a33;
        }

        /* Genel Stil */
        body {
            background-color: var(--bg-dark);
            color: var(--color-text);
            font-family: 'Roboto', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        .auth-container {
            background-color: var(--bg-card);
            padding: 40px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            width: 100%;
            max-width: 400px;
            text-align: center;
        }

        h2 {
            font-family: 'Orbitron', sans-serif;
            color: var(--color-primary);
            margin-bottom: 25px;
            font-weight: 700;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: var(--color-secondary);
            font-weight: 400;
            font-size: 0.9em;
        }

        input[type="email"],
        input[type="password"] {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #333;
            border-radius: var(--border-radius);
            background-color: var(--input-bg);
            color: var(--color-text);
            box-sizing: border-box;
            transition: border-color 0.3s;
        }

        input[type="email"]:focus,
        input[type="password"]:focus {
            border-color: var(--color-primary);
            outline: none;
        }

        .btn-primary, .btn-secondary {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: var(--border-radius);
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-top: 10px;
        }
        
        .btn-primary {
            background-color: var(--color-primary);
            color: var(--bg-card);
        }

        .btn-primary:hover {
            background-color: #008c9e;
        }

        .btn-secondary {
            background-color: var(--color-secondary);
            color: var(--bg-card);
        }

        .btn-secondary:hover {
            background-color: #6a6aed;
        }

        .message {
            padding: 15px;
            border-radius: var(--border-radius);
            margin-top: 20px;
            font-weight: 700;
        }

        .message.success {
            background-color: var(--color-success);
            color: var(--bg-card);
        }

        .message.error {
            background-color: var(--color-danger);
            color: var(--bg-card);
        }

        .link-toggle {
            color: var(--color-secondary);
            cursor: pointer;
            text-decoration: none;
            transition: color 0.3s;
        }

        .link-toggle:hover {
            color: var(--color-primary);
        }
        
        .social-login-group {
            display: flex;
            justify-content: space-between;
            gap: 10px;
            margin-top: 20px;
        }

        .social-btn {
            flex-grow: 1;
            padding: 10px;
            border: none;
            border-radius: var(--border-radius);
            font-size: 1.1em;
            cursor: pointer;
            transition: opacity 0.3s;
            color: white;
        }

        .social-btn:hover {
            opacity: 0.8;
        }

        .google { background-color: #db4437; }
        .twitter { background-color: #1da1f2; }
    </style>
</head>
<body>
    <div class="auth-container">
        
        <div id="login-form-container">
            <h2><i class="fas fa-lock"></i> TradeMirror Giriş</h2>
            <form id="login-form">
                <div class="form-group">
                    <label for="login-username">E-posta</label>
                    <input type="email" id="login-username" required>
                </div>
                <div class="form-group">
                    <label for="login-password">Şifre</label>
                    <input type="password" id="login-password" required>
                </div>
                <button type="submit" class="btn-primary">Giriş Yap</button>
            </form>
            <div id="login-message" class="message" style="display: none;"></div>
            
            <p class="mt-4">
                Hesabınız yok mu? <span class="link-toggle" id="show-register">Kayıt Olun</span>
            </p>
        </div>

        <div id="register-form-container" style="display: none;">
            <h2><i class="fas fa-user-plus"></i> TradeMirror Kayıt</h2>
            <form id="register-form">
                <div class="form-group">
                    <label for="register-username">E-posta</label>
                    <input type="email" id="register-username" required>
                </div>
                <div class="form-group">
                    <label for="register-password">Şifre (Min 8 Karakter)</label>
                    <input type="password" id="register-password" required minlength="8">
                </div>
                <button type="submit" class="btn-secondary">Hemen Kayıt Ol</button>
            </form>
            <div id="register-message" class="message" style="display: none;"></div>

            <p class="mt-4">
                Zaten hesabınız var mı? <span class="link-toggle" id="show-login">Giriş Yapın</span>
            </p>
        </div>
        
    </div>

    <script>
        // KRİTİK DEĞİŞİKLİK: Yerel adresi Render adresi ile değiştirildi
        const BACKEND_URL = "https://borsa-xeqq.onrender.com"; 

        // --- 1. FONKSİYONLAR ---

        // Mesaj gösterme fonksiyonu
        function showMessage(message, type, targetId = 'login-message') {
            const target = document.getElementById(targetId);
            target.textContent = message;
            target.className = `message ${type}`;
            target.style.display = 'block';

            // Mesajı 5 saniye sonra gizle
            setTimeout(() => {
                target.style.display = 'none';
            }, 5000);
        }

        // Form değiştirme fonksiyonu
        function toggleForm(formType) {
            const loginContainer = document.getElementById('login-form-container');
            const registerContainer = document.getElementById('register-form-container');
            
            if (formType === 'login') {
                loginContainer.style.display = 'block';
                registerContainer.style.display = 'none';
                document.getElementById('login-message').style.display = 'none'; // Mesajları temizle
                document.getElementById('register-form').reset(); // Kayıt formunu temizle
            } else if (formType === 'register') {
                loginContainer.style.display = 'none';
                registerContainer.style.display = 'block';
                document.getElementById('register-message').style.display = 'none'; // Mesajları temizle
                document.getElementById('login-form').reset(); // Giriş formunu temizle
            }
        }

        // --- 2. OLAY DİNLEYİCİLER ---

        // Form geçişleri
        document.getElementById('show-register').addEventListener('click', (e) => {
            e.preventDefault();
            toggleForm('register');
        });

        document.getElementById('show-login').addEventListener('click', (e) => {
            e.preventDefault();
            toggleForm('login');
        });

        // Kayıt İşlemi
        document.getElementById('register-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('register-username').value;
            const password = document.getElementById('register-password').value;

            try {
                const response = await fetch(`${BACKEND_URL}/api/v1/users/register`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ email: email, password: password }),
                });

                if (response.ok) {
                    showMessage('Kayıt başarılı! Giriş yapabilirsiniz.', 'success', 'register-message');
                    // Başarılı kayıttan sonra giriş formuna geç
                    setTimeout(() => toggleForm('login'), 2000); 
                } else {
                    const errorData = await response.json();
                    const detail = errorData.detail || 'Bilinmeyen Hata';
                    showMessage(`Kayıt Başarısız: ${detail}`, 'error', 'register-message');
                }

            } catch (error) {
                console.error("Kayıt hatası:", error);
                showMessage("Sunucuya bağlanılamadı. Lütfen sunucuyu kontrol edin.", 'error', 'register-message');
            }
        });


        // Giriş İşlemi
        document.getElementById('login-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('login-username').value;
            const password = document.getElementById('login-password').value;

            const formData = new URLSearchParams();
            formData.append('username', email); // FastAPI OAuth2'de 'username' beklenir
            formData.append('password', password);

            try {
                const response = await fetch(`${BACKEND_URL}/api/v1/token`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: formData.toString(),
                });

                if (response.ok) {
                    const data = await response.json();
                    localStorage.setItem('access_token', data.access_token);
                    
                    // Token aldıktan sonra ana sayfaya yönlendir
                    window.location.href = 'index.html'; 
                } else {
                    showMessage("Giriş Başarısız: Hatalı e-posta veya şifre.", 'error');
                }

            } catch (error) {
                console.error("Giriş hatası:", error);
                showMessage("Sunucuya bağlanılamadı. Lütfen sunucuyu kontrol edin.", 'error');
            }
        });

        // --- 4. SOSYAL GİRİŞ (KALDIRILDI) ---\n        // socialLogin fonksiyonu artık çağrılmıyor/kullanılmıyor

        document.addEventListener('DOMContentLoaded', () => {
             // Başlangıçta Giriş formunu göster
             toggleForm('login');
        });
    </script>
</body>
</html>